boxlength = 26.8483333587646;
ksi = 2.837;
CONV = 332.112;
forwardNegQ = [0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardNegTotals = [4.62556 9.03393 13.3796 17.5593 21.5076 25.4353 29.1729 32.7092 36.1422 39.3336 42.3561 45.2632 47.9602 50.5991 53.027 55.4042 57.5315 59.502 61.296 62.8034 64.1045 64.9561 65.8093 66.4948 66.9942 67.3213 67.4876 67.514 67.4853 67.2986 66.9978 66.5574 66.0165 65.3376 64.5532 63.6387 62.6202 61.6217 60.4016 59.0207 57.5471 55.9737 54.2827 52.4942 50.5083 48.4631 46.3787 44.1105 41.7933 39.3342 ]';
reversedBackwardNegTotals = [ 4.62704 8.97477 13.30072 17.43766 21.47551 25.26726 28.98934 32.55519 36.03931 39.2866 42.34759 45.29129 48.03306 50.55454 53.03578 55.37899 57.54816 59.57345 61.35474 62.74164 63.90031 65.00499 65.88614 66.482129 66.961228 67.269133 67.499032 67.5213169 67.4739526 67.3221776 66.9998936 66.5723436 66.0325726 65.3663356 64.5501156 63.6930656 62.7602446 61.5768946 60.3224246 58.9722146 57.4224146 55.8355346 54.1418646 52.2967746 50.3550146 48.3054046 46.2409046 44.0056446 41.5821446 39.1754946 ]';
q = [-1; -1+((1)-(-1))*forwardNegQ];
Izero = find(abs(q)< 1e-3);
correctedFNtotals = [0; forwardNegTotals] - 0.5*ksi*CONV*(q.^2 - (-1).^2) / boxlength;
correctedFNtotals = correctedFNtotals - correctedFNtotals(Izero);
correctedBNtotals = [0;reversedBackwardNegTotals] -reversedBackwardNegTotals(Izero) - 0.5*ksi*CONV*(q.^2-(-1).^2) / boxlength;
correctedBNtotals = correctedBNtotals - correctedBNtotals(Izero);
Qdata = [q; q]; 
Edata = [correctedFNtotals; correctedBNtotals;];
lsmatConstrained = [Qdata.^2 Qdata];
lsmatUnconstrained = [Qdata.^2 Qdata ones(length(Qdata),1)];
xConstrained = lsmatConstrained \ Edata;
xUnconstrained = lsmatUnconstrained \ Edata;
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
off35 = struct('boxlength',boxlength,'q',q,'forwardNegQ',forwardNegQ,'forwardNegTotals',forwardNegTotals,'reversedBackwardNegTotals',reversedBackwardNegTotals, 'correctedFNtotals',correctedFNtotals,'correctedBNtotals',correctedBNtotals,'Qdata',Qdata,'Edata',Edata,'lsmatConstrained',lsmatConstrained,'lsmatUnconstrained',lsmatUnconstrained,'xConstrained',xConstrained,'xUnconstrained',xUnconstrained,'L_constrained',L_constrained,'L_unconstrained',L_unconstrained,'phiStatic_constrained',phiStatic_constrained,'phiStatic_unconstrained',phiStatic_unconstrained,'offset_unconstrained',offset_unconstrained);
