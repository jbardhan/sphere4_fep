boxlength = 26.8483333587646;
ksi = 2.837;
CONV = 332.112;
forwardNegQ = [0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardNegTotals = [3.44677 6.76566 9.9818 13.0732 15.9512 18.8135 21.4785 24.0823 26.5473 28.9365 31.173 33.2762 35.1266 36.9255 38.6832 40.3251 41.7844 43.1399 44.3375 45.4029 46.2989 47.0393 47.6904 48.2664 48.7334 49.112 49.4143 49.5276 49.6003 49.5619 49.4355 49.2418 48.9449 48.549 48.0709 47.4579 46.7892 46.0474 45.2358 44.2952 43.2347 42.1706 40.9792 39.6322 38.2316 36.7438 35.1988 33.6002 31.9207 30.1374 ]';
reversedBackwardNegTotals = [ 3.41603 6.74678 9.91518 12.96364 15.87263 18.71829 21.35018 23.93113 26.35339 28.69213 30.98023 33.13029 35.11072 36.95768 38.52809 40.13055 41.57897 42.85891 44.08242 45.08455 46.005557 46.81454 47.491603 48.053495 48.493588 48.869601 49.159559 49.348276 49.4342861 49.4722391 49.3023441 49.0831681 48.7910411 48.3853251 47.8730781 47.3105621 46.6422681 45.8788651 45.0154351 44.0933631 43.0533931 41.9073131 40.6776631 39.3733131 38.0101031 36.5788231 35.0748831 33.4304431 31.7616531 29.9554731 ]';
q = [-1; -1+((+1)-(-1))*forwardNegQ];
Izero = find(abs(q)< 1e-3);
correctedFNtotals = [0; forwardNegTotals] - 0.5*ksi*CONV*(q.^2 - (-1).^2) / boxlength;
correctedFNtotals = correctedFNtotals - correctedFNtotals(Izero);
correctedBNtotals = [0;reversedBackwardNegTotals] -reversedBackwardNegTotals(Izero) - 0.5*ksi*CONV*(q.^2-(-1).^2) / boxlength;
correctedBNtotals = correctedBNtotals - correctedBNtotals(Izero);
Qdata = [q; q]; 
Edata = [correctedFNtotals; correctedBNtotals;];
lsmatConstrained = [Qdata.^2 Qdata];
lsmatUnconstrained = [Qdata.^2 Qdata ones(length(Qdata),1)];
xConstrained = lsmatConstrained \ Edata;
xUnconstrained = lsmatUnconstrained \ Edata;
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
off30 = struct('boxlength',boxlength,'q',q,'forwardNegQ',forwardNegQ,'forwardNegTotals',forwardNegTotals,'reversedBackwardNegTotals',reversedBackwardNegTotals, 'correctedFNtotals',correctedFNtotals,'correctedBNtotals',correctedBNtotals,'Qdata',Qdata,'Edata',Edata,'lsmatConstrained',lsmatConstrained,'lsmatUnconstrained',lsmatUnconstrained,'xConstrained',xConstrained,'xUnconstrained',xUnconstrained,'L_constrained',L_constrained,'L_unconstrained',L_unconstrained,'phiStatic_constrained',phiStatic_constrained,'phiStatic_unconstrained',phiStatic_unconstrained,'offset_unconstrained',offset_unconstrained);
