boxlength = 26.8483333587646;
ksi = 2.837;
CONV = 332.112;
forwardNegQ = [0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardNegTotals = [1.65319 3.25281 4.78095 6.21571 7.60592 8.99256 10.316 11.5636 12.7899 13.9594 15.0754 16.155 17.1809 18.1262 19.0501 19.8871 20.6898 21.4665 22.191 22.8361 23.4507 24.0057 24.5312 25.0068 25.415 25.7958 26.1257 26.423 26.6626 26.8559 27.0008 27.0841 27.1514 27.1473 27.1396 27.0467 26.903 26.7028 26.4653 26.2048 25.8952 25.5481 25.1279 24.6776 24.1798 23.6513 23.0529 22.4215 21.7426 21.0029 ]';
reversedBackwardNegTotals = [ 1.61465 3.19546 4.73722 6.20298 7.63436 9.00332 10.3033 11.569 12.77825 13.95504 15.09386 16.141 17.126757 18.117795 19.019108 19.868498 20.695958 21.46335 22.193682 22.894553 23.508834 24.075963 24.62328 25.111645 25.540094 25.903007 26.251228 26.547759 26.798223 27.002476 27.139344 27.2200145 27.2870332 27.3115926 27.2732589 27.1788467 27.0571827 26.8776197 26.6596417 26.3887747 26.0968527 25.7147077 25.3217887 24.8372437 24.3535537 23.7997087 23.2090727 22.5817967 21.9201577 21.1997847 ]';
q = [-1; -1+((1)-(-1))*forwardNegQ];
Izero = find(abs(q)< 1e-3);
correctedFNtotals = [0; forwardNegTotals] - 0.5*ksi*CONV*(q.^2 - (-1).^2) / boxlength;
correctedFNtotals = correctedFNtotals - correctedFNtotals(Izero);
correctedBNtotals = [0;reversedBackwardNegTotals] -reversedBackwardNegTotals(Izero) - 0.5*ksi*CONV*(q.^2-(-1).^2) / boxlength;
correctedBNtotals = correctedBNtotals - correctedBNtotals(Izero);
Qdata = [q; q]; 
Edata = [correctedFNtotals; correctedBNtotals;];
lsmatConstrained = [Qdata.^2 Qdata];
lsmatUnconstrained = [Qdata.^2 Qdata ones(length(Qdata),1)];
xConstrained = lsmatConstrained \ Edata;
xUnconstrained = lsmatUnconstrained \ Edata;
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
off05 = struct('boxlength',boxlength,'q',q,'forwardNegQ',forwardNegQ,'forwardNegTotals',forwardNegTotals,'reversedBackwardNegTotals',reversedBackwardNegTotals, 'correctedFNtotals',correctedFNtotals,'correctedBNtotals',correctedBNtotals,'Qdata',Qdata,'Edata',Edata,'lsmatConstrained',lsmatConstrained,'lsmatUnconstrained',lsmatUnconstrained,'xConstrained',xConstrained,'xUnconstrained',xUnconstrained,'L_constrained',L_constrained,'L_unconstrained',L_unconstrained,'phiStatic_constrained',phiStatic_constrained,'phiStatic_unconstrained',phiStatic_unconstrained,'offset_unconstrained',offset_unconstrained);
