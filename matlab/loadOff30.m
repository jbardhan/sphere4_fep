boxlength = 26.8483333587646;
ksi = 2.837;
CONV = 332.112;
forwardNegQ = [0.05 0.1 0.15 0.2 0.25 0.3 0.35 0.4 0.45 0.5 0.55 0.6 0.65 0.7 0.75 0.8 0.85 0.9 0.95 1 ]';
forwardNegTotals = [7.57872 14.4786 20.8885 26.5324 31.3227 35.9204 39.6017 42.5934 45.1965 47.2727 49.1348 50.0291 50.2433 50.1379 49.3096 48.1617 46.7542 44.6778 42.172 39.2373 ]';
reversedBackwardNegTotals = [ 7.28252 14.04544 19.92145 25.42752 30.12908 34.721 38.5044 41.83907 44.45047 46.62135 48.07207 48.951994 49.336724 49.199748 48.718995 47.440215 45.770695 43.811745 41.382615 38.655015 ]';
q = [-1; -1+((1)-(-1))*forwardNegQ];
Izero = find(abs(q)< 1e-3);
correctedFNtotals = [0; forwardNegTotals] - 0.5*ksi*CONV*(q.^2 - (-1).^2) / boxlength;
correctedFNtotals = correctedFNtotals - correctedFNtotals(Izero);
correctedBNtotals = [0;reversedBackwardNegTotals] -reversedBackwardNegTotals(Izero) - 0.5*ksi*CONV*(q.^2-(-1).^2) / boxlength;
correctedBNtotals = correctedBNtotals - correctedBNtotals(Izero);
Qdata = [q; q]; 
Edata = [correctedFNtotals; correctedBNtotals;];
lsmatConstrained = [Qdata.^2 Qdata];
lsmatUnconstrained = [Qdata.^2 Qdata ones(length(Qdata),1)];
xConstrained = lsmatConstrained \ Edata;
xUnconstrained = lsmatUnconstrained \ Edata;
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
off30 = struct('boxlength',boxlength,'q',q,'forwardNegQ',forwardNegQ,'forwardNegTotals',forwardNegTotals,'reversedBackwardNegTotals',reversedBackwardNegTotals, 'correctedFNtotals',correctedFNtotals,'correctedBNtotals',correctedBNtotals,'Qdata',Qdata,'Edata',Edata,'lsmatConstrained',lsmatConstrained,'lsmatUnconstrained',lsmatUnconstrained,'xConstrained',xConstrained,'xUnconstrained',xUnconstrained,'L_constrained',L_constrained,'L_unconstrained',L_unconstrained,'phiStatic_constrained',phiStatic_constrained,'phiStatic_unconstrained',phiStatic_unconstrained,'offset_unconstrained',offset_unconstrained);
