boxlength = 26.8483333587646;
ksi = 2.837;
CONV = 332.112;
forwardNegQ = [0.02 0.04 0.06 0.08 0.1 0.12 0.14 0.16 0.18 0.2 0.22 0.24 0.26 0.28 0.3 0.32 0.34 0.36 0.38 0.4 0.42 0.44 0.46 0.48 0.5 0.52 0.54 0.56 0.58 0.6 0.62 0.64 0.66 0.68 0.7 0.72 0.74 0.76 0.78 0.8 0.82 0.84 0.86 0.88 0.9 0.92 0.94 0.96 0.98 1 ]';
forwardNegTotals = [2.98166 5.8984 8.7566 11.4782 14.1465 16.7048 19.1032 21.4464 23.6949 25.8361 27.8921 29.8907 31.7918 33.6202 35.3199 36.9623 38.5119 39.9766 41.3597 42.618 43.6725 44.7204 45.7397 46.6761 47.4756 48.1218 48.6894 49.162 49.5089 49.7435 49.9632 50.1312 50.1823 50.1443 50.0417 49.8707 49.6232 49.2364 48.803 48.3016 47.7611 47.1419 46.4281 45.6408 44.7618 43.8503 42.8441 41.748 40.6142 39.4097 ]';
reversedBackwardNegTotals = [ 3.00441 5.95197 8.77159 11.49506 14.16174 16.70006 19.09328 21.5034 23.8187 25.97095 28.02649 30.07707 31.95925 33.76613 35.5137 37.1321 38.63032 40.09856 41.45675 42.77949 43.98626 45.13487 46.14152 47.050399 47.900412 48.682667 49.299058 49.709957 50.061719 50.373291 50.614429 50.749334 50.7811567 50.7604621 50.6572241 50.4364821 50.1330961 49.8121421 49.4024511 48.9372951 48.3535391 47.6899511 46.9597111 46.1903071 45.3401711 44.3913911 43.4161931 42.3220331 41.1588431 39.9446631 ]';
q = [-1; -1+((1)-(-1))*forwardNegQ];
Izero = find(abs(q)< 1e-3);
correctedFNtotals = [0; forwardNegTotals] - 0.5*ksi*CONV*(q.^2 - (-1).^2) / boxlength;
correctedFNtotals = correctedFNtotals - correctedFNtotals(Izero);
correctedBNtotals = [0;reversedBackwardNegTotals] -reversedBackwardNegTotals(Izero) - 0.5*ksi*CONV*(q.^2-(-1).^2) / boxlength;
correctedBNtotals = correctedBNtotals - correctedBNtotals(Izero);
Qdata = [q; q]; 
Edata = [correctedFNtotals; correctedBNtotals;];
lsmatConstrained = [Qdata.^2 Qdata];
lsmatUnconstrained = [Qdata.^2 Qdata ones(length(Qdata),1)];
xConstrained = lsmatConstrained \ Edata;
xUnconstrained = lsmatUnconstrained \ Edata;
L_constrained = xConstrained(1);
L_unconstrained = xUnconstrained(1);
phiStatic_constrained = xConstrained(2);
phiStatic_unconstrained = xUnconstrained(2);
offset_unconstrained = xUnconstrained(3);
off30 = struct('boxlength',boxlength,'q',q,'forwardNegQ',forwardNegQ,'forwardNegTotals',forwardNegTotals,'reversedBackwardNegTotals',reversedBackwardNegTotals, 'correctedFNtotals',correctedFNtotals,'correctedBNtotals',correctedBNtotals,'Qdata',Qdata,'Edata',Edata,'lsmatConstrained',lsmatConstrained,'lsmatUnconstrained',lsmatUnconstrained,'xConstrained',xConstrained,'xUnconstrained',xUnconstrained,'L_constrained',L_constrained,'L_unconstrained',L_unconstrained,'phiStatic_constrained',phiStatic_constrained,'phiStatic_unconstrained',phiStatic_unconstrained,'offset_unconstrained',offset_unconstrained);
